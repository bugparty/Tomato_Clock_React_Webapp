variables:

image: bowmanhan/node:10.11.0-alpine

cache:
  paths:
  - node_modules/
stages:
- test
- deploy


dev_test:
  stage: test
  environment: dev
  only:
  - dev
  script:
  - yarn install
  - yarn test

deploy_production:
  stage: deploy
  environment: production
  only:
  - master
  artifacts:
    paths:
    - dist/
  script:
  - yarn install
  - yarn build
  - yarn postbuild
  - cd build/
  - sshpass -V
  - export SSHPASS=$USER_PASS
  - sshpass -e scp  -o stricthostkeychecking=no -r . root@b1.calm.gq:/var/www/pomometer/
